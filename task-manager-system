import json
from datetime import datetime
import os

class TaskManager:
    def __init__(self, filename="tasks.json"):
        self.filename = filename
        self.tasks = self.load_tasks()
    
    def load_tasks(self):
        """Carrega tarefas do arquivo JSON"""
        if os.path.exists(self.filename):
            with open(self.filename, 'r', encoding='utf-8') as file:
                return json.load(file)
        return []
    
    def save_tasks(self):
        """Salva tarefas no arquivo JSON"""
        with open(self.filename, 'w', encoding='utf-8') as file:
            json.dump(self.tasks, file, ensure_ascii=False, indent=2)
    
    def add_task(self, title, description, priority="MÃ©dia"):
        """Adiciona uma nova tarefa"""
        task = {
            "id": len(self.tasks) + 1,
            "title": title,
            "description": description,
            "priority": priority,
            "status": "Pendente",
            "created_at": datetime.now().strftime("%d/%m/%Y %H:%M"),
            "completed_at": None
        }
        self.tasks.append(task)
        self.save_tasks()
        print(f"âœ… Tarefa '{title}' adicionada com sucesso!")
    
    def list_tasks(self):
        """Lista todas as tarefas"""
        if not self.tasks:
            print("ğŸ“ Nenhuma tarefa encontrada.")
            return
        
        print("\n" + "="*50)
        print("ğŸ“‹ LISTA DE TAREFAS")
        print("="*50)
        
        for task in self.tasks:
            status_icon = "âœ…" if task["status"] == "ConcluÃ­da" else "â³"
            print(f"{status_icon} #{task['id']} - {task['title']}")
            print(f"   ğŸ“ DescriÃ§Ã£o: {task['description']}")
            print(f"   ğŸ¯ Prioridade: {task['priority']}")
            print(f"   ğŸ“… Criada em: {task['created_at']}")
            print(f"   ğŸ“Š Status: {task['status']}")
            if task["completed_at"]:
                print(f"   ğŸ ConcluÃ­da em: {task['completed_at']}")
            print("-" * 40)
    
    def complete_task(self, task_id):
        """Marca uma tarefa como concluÃ­da"""
        for task in self.tasks:
            if task["id"] == task_id:
                task["status"] = "ConcluÃ­da"
                task["completed_at"] = datetime.now().strftime("%d/%m/%Y %H:%M")
                self.save_tasks()
                print(f"ğŸ‰ Tarefa '{task['title']}' concluÃ­da!")
                return
        print("âŒ Tarefa nÃ£o encontrada.")
    
    def delete_task(self, task_id):
        """Remove uma tarefa"""
        self.tasks = [task for task in self.tasks if task["id"] != task_id]
        self.save_tasks()
        print(f"ğŸ—‘ï¸ Tarefa #{task_id} removida!")

def main():
    manager = TaskManager()
    
    while True:
        print("\n" + "="*40)
        print("ğŸ¯ SISTEMA DE GERENCIAMENTO DE TAREFAS")
        print("="*40)
        print("1. â• Adicionar tarefa")
        print("2. ğŸ“‹ Listar tarefas")
        print("3. âœ… Concluir tarefa")
        print("4. ğŸ—‘ï¸ Remover tarefa")
        print("5. ğŸšª Sair")
        
        choice = input("\nğŸ“ Escolha uma opÃ§Ã£o: ")
        
        if choice == "1":
            title = input("ğŸ“Œ TÃ­tulo da tarefa: ")
            description = input("ğŸ“ DescriÃ§Ã£o: ")
            priority = input("ğŸ¯ Prioridade (Alta/MÃ©dia/Baixa) [MÃ©dia]: ") or "MÃ©dia"
            manager.add_task(title, description, priority)
        
        elif choice == "2":
            manager.list_tasks()
        
        elif choice == "3":
            try:
                task_id = int(input("ğŸ”¢ ID da tarefa para concluir: "))
                manager.complete_task(task_id)
            except ValueError:
                print("âŒ Por favor, insira um ID vÃ¡lido.")
        
        elif choice == "4":
            try:
                task_id = int(input("ğŸ”¢ ID da tarefa para remover: "))
                manager.delete_task(task_id)
            except ValueError:
                print("âŒ Por favor, insira um ID vÃ¡lido.")
        
        elif choice == "5":
            print("ğŸ‘‹ Saindo do sistema...")
            break
        
        else:
            print("âŒ OpÃ§Ã£o invÃ¡lida. Tente novamente.")

if __name__ == "__main__":
    main()
